# SED (스팀라인드 에디터; Streamlined editor)
이 기능은 ubuntu 설치후 source.list 파일을 변경하는 과정에서 사용했던 유용한 명령어를 정리하기 위함이다.
``` shell
$ sed 's/archive.ubuntu.com/ftp.daumkakao.com/g' /etc/apt/sources.list
```
이 명령어는 /etc/apt/sources.list 이 파일에서 archive.ubuntu.com 이란 문자열을 ftp.daumkakao.com로 전체에 걸쳐 치환하라는 명령어이다.
이제 설명을 시작한다.

sed란 입력-작업-출력 방식으로 작동되는 대화형 기능이 없는 편집기이다.
명령행에서 직접 편집 명령어와 파일을 지정하여 작업한 후 결과를 화면으로 확인한다. 

## 주소 지정
주소 지정이란 편집하고자 하는 행을 선택하는 것을 말한다. 이 주소는 숫자나 정규표현식 또는 둘의 조합으로 표현한다. 주소를 지정하지 않은 경우 입력 파일 전체 행에 대하여 작업을 진행한다.

``` shell
$ sed '1,3p' datafile
```

이 명령은 datafile에서 1행에서 3행까지 출력한다. __p__는 행을 출력하라는 명령어이다.

``` shell
$ sed -n '/[Ll]ove/p' datafile
```

이 명령은 datafile에서 Love나 love를 포함하는 행만 출력한다.

## 명령어와 옵션

명령어 | 뜻
-------|----
a\ | 현재 행에 하나 이상의 새로운 행을 추가한다.
c\ | 현재 행의 내용을 새로운 내용으로 바꾼다.
i\ | 현재 행의 위애 삽입한다.
d | 행을 삭제한다
l | 출력되지 않는 특수문자를 출력한다.
p | 행을 출력한다.
n | 다음 입력행을 첫번째 명령어가 아닌 다음 명령어에서 처리하게 한다.
q | sed를 종료한다.
r | 파일로 부터 행을 읽어온다.
! | 선택된 행을 제외한 전체 행에 명령어를 적용한다.
s | 문자열을 치환한다.
/g | 한줄에 대상 문자가 여러개일 때도 처리하도록 한다.

## 옵션

명령어 | 뜻
-------|-----
-e | 다중 편집시 사용
-f | sed 스크립트 파일 지정에 사용
-n | 전체 출력을 생략하고, 패턴이 일치하는 줄만 출력하도록 한다.
-i | 편집결과를 반영하여 원본파일을 수정한다. (백업필수)

	다중 명령어를 사용하거나 주종 지정이 다른 주소지정범위와 중첩되는 경우에는 명령어들을 중괄호 안에 넣고 각 명령어의 끝에 세미콜론을 붙인다. !는 명령어를 반전하는데 사용한다. 다음 예는 love를 포함하지 않은 행들을 삭제한다.

``` shell
$ sed '/love/!d' datafile
```

## 메타 문자
grep 등과 마찬가지로 sed는 패턴검색을 위하여 특별한 메타문자를 제공한다.

메타 문자 | 뜻
----------|-----
/^love/ | love로 시작하는 행
/love$/ | love로 끝나는 행
. | 하나의 문자와 대응
/l..e/ | l 다음에 두글자가 오고 e로 끝나는 문자열을 포함하는 행
/\*love/ | 0개 혹은 임의 갯수의 공백 문자 후에 love로 끝나는 문자열을 포함한 행
\* | 0개 혹은 임의의 임의 갯수
[] | [] 사이의 문자 집합중 하나와 대응 / 예:  /[Ll]ove/ : Love 또는 love를 포함한 행
[^] | 문자 집합에 속하지 않는 한 문자와 대응
/[^A-K]ove/ | A 와 K 사이의 범위에 포함되지 않는 한 문자와 ove가 붙어있는 문자열
(..) | 태그로 저장할 수 있는 문자열 지정에 사용
s/\(lov\)able/\1er/ | 지정된 부분(lov)을 태그 1에 저장하였다가 사용한다. 태그를 참조하기 위해서는 \1을 사용한다. 태그는 9개까지 사용할 수 있다. 예제에서 lovable이 lover로 치환
& | 검색열을 저장하여 치환열에서 사용할 수 있게한다.
s/love/&/ | 검색열 love가 love로 치환된다.
\< | 단어의 시작 지시자
\> | 단어의 끝 지시자
x\{m\} | 문자 x를 m번 반복
x\{m,\} | 적어도 m번 반복
x\{m,n\} | m회 이상 n회 이하 반복

## 예제
### 1) 출력: p
``` shell
$ sed '/love/p' datafile
```
기본 설정에서는 모든 행을 표준 출력으로 내보낸다. 패턴 love가 있는 행을 찾으면 그 행을 한번 더 출력한다.

```shell
$ sed -n '/love/p' datafile
```
기본 설정에 의한 p 명령어의 동작을 제한한다. -n 옵션을 사용하면 love 패턴을 포함하는 행들만 출력한다.

### 2) 삭제: d 
``` shell
$ sed '3d' datafile
```
3번 행을 삭제한다. 다른 행들은 기본적으로 한번 출력된다.

``` shell
$ sed '3,$d' datafile
```
3번 행부터 마지막 행까지 삭제한다. 그리고 나머지 행들이 출력된다.

``` shell
$ sed '$d' datafile
```
마지막 행을 삭제한다. 삭제된 행 이외의 모든 행들이 출력된다.

```shell
$ sed '/love/d' datafile
```
love를 포함한 모든 행을 삭제하고, 나머지 행들을 출력한다.

### 3) 치환: s
``` shell
$ sed 's/love/peace/g' datafile
```
love를 peace로 치환한다. g플래그는 행 전체에 치환이 적용됨을 의미한다. g플래그가 없으면 행에서 맨 처음 등장하는 love만 peace로 치환된다.

``` shell
$ sed -n 's/^love/peace/p' datafile
```
-n 옵션은 p플래그와 같이 사용되어 치환이 일어난 행만 출력한다.

``` shell
$ sed 's/[0-9][0-9]$/&.5/' datafile
```

&는 검색열에서 지정한 문자열을 대신한다. 즉 두자리 숫자로 끝나는 행은 그 숫자들에 .5가 추가된다.

``` shell
$ sed -n 's/love/peace/gp' datafile
```

love가 peace로 치환된 행들만 출력한다. -n 옵션이 p 명령어와 함께 사용되어 출력을 간단하게 줄여준다. g플래그는 각 행에서 전체 치환이 일어나게 한다.

``` shell
$ sed 's#3#99#g' datafile
```
s 명령어 바로 다음에 오는 문자는 검색열과 치환열을 구분해주는 구분자이다. 기본적으로 /를 구분자로 사용하지만, 다른 문자로 바꾸어 쓸 수 있다. 이는 / 자체를 포함하는 문자열을 검색할 때 유용하다.

### 4) 행의 선택 범위 : 쉼표(,)
```shell
$ sed -n '/love/,/peace/p' datafile
```
love가 나오는 행과 peace가 나오는 행 사이의 모든 행들이 출력된다. love가 peace 다음에 나오면 love가 나오는 행부터 마지막 행까지 출력된다.


[출처](https://openwiki.kr/tech/sed)
