# item35. 비공개 데이터를 저장하기 위해 클로저를 사용하라
-----

자바스크립트의 객체시스템은 정보은닉을 강제하거나 권장하지 않는다.
모든 프로퍼티의 이름은 문자열이고, 프로그램 내에서 그 이름을 통해 객체의 어떤 프로퍼티라도 저장할 수 있다.
심지어 for...in 반복문이나, ES5의 Object.keys(), Object.getOwnPropertyNames() 함수와 같은 기능들은 한 객체의 모든 프로퍼티 이름을 쉽게 알아낼 수 있게 해준다.

흔히 자바스크립트 프로그래머는 비공개 프로퍼티를 위한 어떤 절대적인 강제 메커니즘 보다는 코딩컨벤션에 의존한다. 
예를들어 몇몇 프로그래머는 비공개 프로퍼티에 밑줄문자(_)를 접두어나 접미어로 붙이는 명명 규칙을 사용한다.
이 방법은 정보 은닉을 정혀 강제하지 않지만, 객체를 제대로 사용하는 사용자가 프로퍼티를 검사하거나 수정하지 않도록 제안하고, 그 덕에 객체의 구현이 자유롭게 변경될 수 있는 상태로 남게해준다.

그럼에도 불구하고, 어떤 프로그램은 실제로 더 높은 수준의 은닉을 필요로한다. 
예를들어 보안에 민감한 플랫폼이나 애플리케이션 프레임워크는 신뢰하지 않는 애플리케이션 객체를 전달할 때, 해당 애플리케이션이 객체의 내부에 손대지 않기를 바랄 것이다. 
정보 은닉을 강제하는 것이 유용한 또 다른 경우로는, 사용자가 별 주의없이 라이브러리를 많이 사용하는데 뜻하지 않게 구현의 세부ㅎ사항에 의존하거나 이를 간섭하여 이상한 버그가 발생할 때다.
자바스크립트는 이러한 상황에 정보를 은닉하기 위한 매우 신뢰할 만한 메커니즘을 제공하는데, 바로 __클로저__ 다.

클로저는 꾸밈없는 데이터 구조다. 클로저는 내포한 변수에 데이터를 저장하고, 이 변수들에 대한 직접적인 접근을 제공하지 않는다.
클로저의 내부에 접근할 수 있는 유일한 방법은 함수에 클로저의 접근을 명시적으로 제공하는 것이다.
다시말해서, 객체와 클로저는 반대의 정책을 가진다. 객체의 프로퍼티는 자동으로 노출되고, 클로저에 있는 변수는 자동으로 숨겨진다.
이를 이용해 진짜로 비공개인 데이터를 객체에 저장할 수 있다.
데이터를 객체의 프로퍼티로 저장하는 대신에, 생성자 내의 변수로 저장하고, 객체의 메서드는 이변수를 참조하는 클로저로 바꾼다. 

예를 보자.
``` javascript
function User(name, passwordHash){
	this.toString = function(){
		return '[User ' + name + ']';
	}
	this.passwordHash = function(passwordHash){
		return hash(password) === passwordHash;
	}
}
```

여는 구현과는 다르게, toString()과 checkPassword 메소드가 name과passwordHash를 this의 프로퍼티가 아닌 변수로 참조하는 부분에 주목하라.
User의 인스턴스는 어떠한 인스턴스 프로퍼티도 가지지 않으므로, 외부의 코드는 User 인스턴스의 name과 passwordHash에 직접 접근할 수 없다.

이 패턴의 단점은 생성자의 변수가 그 변수를 사용하는 메서드의 스코프 내에 있게하기 위해서는, 반드시 이 메서드가 인스턴스 객체에 위치해야 한다는 것이다. 
또한 아이템 34에서 논의한 것 처럼, 메서드 복사가 급증하는 결과를 초래한다. 그럼에도 불구하고, 정보 은닉을 보장하는 것이 매우 중요한 상황에서는 추가적인 비용을 치를 만한 가치가 있다.

### 기억할 점
* 클로저 변수는 비공개고, 지역적인 참조로만 접근할 수 있다.
* 메서드 안에 강제로 정보를 숨기기 위해 비공개 데이터로써 지역변수를 사용하라.
