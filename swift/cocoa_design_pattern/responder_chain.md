# Responder chain
리스폰더 체인은 코코아 그래픽 애플리케이션의 핵심적이고 중요한 요소이다. 사용자가 생성하는 이벤트들을 적합한 객체에게 전달하는 교통 정리 역할을 하며, 또한 컨텍스트에 민감한 애플리케이션 기능들의 구현을 단순화 하는 데 기여한다.

이 리스폰터 체인을 구현하는 패턴을 바로 Chain of Responsibility(책임의 전가) 패턴이라고 부른다.

* 책임의 전가 패턴:  요청을 처리할 수 있는 기회를, 하나 이상의 객체에 부여함으로써 요청하는 객체와 처리하는 객체 사이의 결합도를 없애려는 것이다. 요청을 해결할 객체를 만날 때까지 고리를 따라서 요청을 전달한다.


## 패턴이 만들어진 동기
사용자 입력을 적합한 객체에게 정확히 전달하도록 제어한다.
현재 활성화 되어 있거나 선택된 사용자 인터페이스 요소에게 액션 메세지를 동적으로 선별하여 전달하도록 한다.
사용자 입력이나 애플리케이션의 상태변화에 따라 사용자 인터페이스 요소들이 스스로의 상태를 자동으로 업데이트 할 수 있도록 한다. 

## 패턴으로 문제 해결
그래픽 사용자 인터페이스를 사용하는 애플리케이션은 보통 "사용자가 지금 현재 초점을 맞추고 있는 활성창 내의 인터페이스 요소"라는 개념을 사용하고 있다. 여기서 바로 "그러면 어떻게 현재 활성 및 초점이 맞춰져 있는 객체에게 메시지와 이벤트를 전달할 것인가" 라는 문제를 흔히 접하게 된다.

왜냐하면 사용자가 매번 다른 인터페이스 요소를 사용할 때 애플리케이션이 이 "초점"을 적합한 객체에게 넘겨야 하기 때문이다. 
코코아에서는 Chain of Resposibility 패턴을 접목하여 Responder Chain으로 이 문제를 단번에 해결하도록 되어있다.

수신 객체들이 연결 리스트 형태로 기다리고 있다가 메시지나 이벤트가 발생하면 이 구조에게 차례로 넘겨지게 되어있으며, 그 객체들 중 하나가 메시지를 핸들링 하도록 한다.
결국에슨 하나 또는 다수의 객체들에게 메시지를 수신하거나 무시하도록 기회를 주는 순차적인 시스템인 것이다.

## 용어 
코코아 객체들 중 사용자 입력을 다룰 수 있는 객체들은 모두 NSResponder추상 클래스의 서브클래스이다. 리스폰더의 주 임무는 키보드나 마우스 등의 사용자 입력에 대응하는 것이다.
그리고 NSApplication, NSView 클래스들이 NSResponder의 서브클래스이기 때문에, 현실적으로 볼때 코코아 개발자들이 다루는 대부분의 AppKit 클래스가 리스폰더 클래스인 셈이다. 덧붙여서 NSWindowController, NSViewController, NSDrawer 클래스 또한 NSResponder의 서브클래스이다.

사용자가 주어진 애플리케이션을 조작할 때, 사용자의 초점이 어디에 맞춰져 있는지를 코코아 프레임워크가 자동적으로 기억하도록 되어있다.
 사용자가 키보드로 입력을 넣을때, 입력을 받는 윈도우를'키 윈도우'라고 한다. 그리고 현재 초점이 맞춰져 있는 문서 창을 메인 윈도우 라고 한다. 많은 경우 사용자가 주어진 문서에 바로 키보드로 입력을 넣도록 되어있기 때문에, 이럴 때는 현재 활성창이 동시에 키 윈도우와 메인 윈도우가 되는 것이다.

애플리케이션은 이러한 키 윈도우와 메인 윈도우를 항상 기억하도록 되어있다. NSApplication 인스턴스의 -keyWindow 메시지와 -mainWindow 메시지를 각각 사용하면, 키 NSWindow객체와 NSWindow 객체에 대한 레퍼런스를 얻도록 되어있다.

사용자가 활성창을 다룰 때, 일반적으로 어느 뷰 객체 하나에 초점을 맞추도록 되어있다. 예들 들어서 사용자가 어느 텍스트 필드를 클릭한다고 하면, 사용자가 다음으로 키보드 입력을 넣을 수 있도록 그 텍스트 필드에게 초점이 넘겨져야 한다. 이렇게 현재 초점이 맞춰져 있는 뷰를 첫 번째 Responder 라고 한다. 이 첫번째 리스폰더가 리스폰더체인의 제일 처음 객체인 것이다.
주어진 윈도우의 첫 번째 리스폰더에 대한 레퍼런스를 얻고 싶으면 그 윈도우 객체에게 -firstResponder 메시지를 보내면 된다.

## 리스폰더 체인
이벤트가 발생할 때를 위해 다수의 수신 객체가 리스폰더 체인 내에 엮어져 있다. 첫 번째 리스폰더 객체가 주어진 사용자 입력을 다루지 못한다고 판단하거나 다루지 않겠다고 결정을 하는 경우, 책임을 리스폰더 체인내의 다음 객체에게 넘긴다.

주어진 수신 객체는 -nextResponder 메시지를 보내면 된다. 그리고 차기 객체를 재설정하고 싶으면 -setNextResponder: 메시지를 보내 리스폰더 체인을 변경하면 된다. 

윈도우가 여럿 공존하고 환경에서는 각각의 윈도우 마다 리스폰더 체인을 가지고 있다. 주어진 윈도우 내에서 사용자의 초점이 다른 뷰로 옮겨갈 때마다 리스폰더 체인이 업데이트 된다.
초점을 바꾸기 위해, 새로운 첫 번째 리스폰더가 될 객체에게 "첫 번째 리스폰더가 되겠습니까?" 라는 -acceptFirstResponder 메시지가 전달된다. 
일반적으로 키보드 입력에 대처할 수 있는 객체가 주로 YES값을 돌려 주도록 되어있다. 만일에 YES가 돌아오면, 우선 현재의 첫 번째 리스폰더에게 "선두 자리를 넘기시오" 라는 -resignFirstResponder 메시지가 전달된다.
이 때 만일 현재의 선두 객체가 텍스트 입력을 검열하도록되어있는 텍스트 필드 등이라고 하면, 합당한 텍스트 값이 입력되기 전까지는 현재 첫 번째 리스폰더가 NO 라고 답을 하는 경우가 있다. 최종적으로, 새로운 첫 번째 리스폰더가 될 객체에게 -becomeFirstResponder 메시지가 전달된다. 

코코아 환경은 입력소스와 수신 객체는 절대로 직접적으로 결합되지 않고, 사용자의 초점이 맞춰져 있는 객체를 기반으로 하여 순차적인 객체 목록이 이벤트에 대응하도록 되어있는 것이다. 
